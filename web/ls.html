<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="shortcut icon" href="#">
        <link href="cssFile.css" rel="stylesheet">
        <script type="text/javascript" src="eel.js"></script>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <title>PROJECT-3</title>
    </head>

    <body>
        <div>
            <label class="label1">SELECT YEAR:</label>
            <select style="display:inline-block"title="Select Year" id="selYear" onchange="optionChanged(this.value)"></select>
            <button class="button-7"  title="THIS BUTON WHILE WE CREATE THE DB" onclick="eel.updateDatabase()();">READ DATABASE</button>
        </div>
        <div class="bodyDiv" id="plot">
      
        </div>
        <div class="bodyDiv" id="content1">
            
        </div>
        <div class="bodyDiv" id="content2">
            
            <br>
  
            
            <div class="bodyDiv" id="content3">
     
            </div>
            <br>
            <div id="onPageMessage" class="onPageMessage"></div>
        </div>
        <br>
        <br>
        
    </body>
</html>

<!-- javaScritp -->
<script>
    window.onload =  getDataFromPython;

    eel.expose(getDataFromPython);
    async function getDataFromPython() {
        globalThis.data = await eel.collectData()(); //supposed to be a global so we can access it from any function. 
        iterateDict();
    };


    function iterateDict(){
        var options = ['','2011', '2012','2013','2014','2015','2016','2017','2018','2019','2020', '2021'];
        var select = document.getElementById("selYear");
        for(var i = 0; i < options.length; i++) {
            var opt = options[i];
            var el = document.createElement("option");
            el.textContent = opt;
            el.value = opt;
            select.appendChild(el);
        }
      
    };
    function optionChanged() {
        document.getElementById("onPageMessage").innerText = "";
        yearSelected = document.getElementById("selYear").value;
        addPlot(yearSelected);
    }


    function addPlot(yearSelected) {
        states = [
            'Alaska',	
            'Arizona',	
            'Arkansas',	
            'California',	
            'Colorado',	
            'Connecticut',	
            'Delaware',	
            'Florida',	
            'Georgia',	
            'Hawaii',	
            'Idaho',	
            'Illinois',	
            'Indiana',	
            'Iowa',	
            'Kansas',	
            'Kentucky',	
            'Louisiana',	
            'Maine',	
            'Maryland',	
            'Massachusetts',	
            'Michigan',	
            'Minnesota',	
            'Mississippi',	
            'Missouri',	
            'Montana',	
            'Nebraska',	
            'Nevada',	
            'New Hampshire',	
            'New Jersey',	
            'New Mexico',	
            'New York',	
            'North Carolina',
            'North Dakota','Ohio',	
            'Oklahoma',	
            'Oregon',
            'Pennsylvania',	
            'Rhode Island',
            'South Carolina',
            'South Dakota',
            'Tennessee',
            'Texas',
            'Utah',
            'Vermont',
            'Virginia',
            'Washington',
            'West Virginia',
            'Wisconsin',
            'Wyoming',
            'American Samoa',
            'District of Columbia',
            'Federated States of Micronesia',
            'Guam',
            'Marshall Islands',
            'Northern Mariana Islands',
            'Palau',
            'Puerto Rico',
            'Virgin Islands'
        ]

        ySelectedArray = [];
        data.forEach((element) => {
            // alert(element.YearEnd);
            if (element.YearEnd == yearSelected){
                ySelectedArray.push(element);
            }
        });

        var dictOfStates = {};
        states.forEach((st) => {
            dataValue = 0
                count = 0
            ySelectedArray.forEach((element) => {  
                if (element.LocationDesc == st ){
                    count = count + 1
                    dataValue = Number(dataValue) + Number(element.Data_Value)
                    console.log("dataValue1 " + dataValue)
                    console.log("count");
                    console.log(count);
                }
                
                dVal = (Number(dataValue) / Number(count));
                console.log(dVal)
                if (dVal == "NaN"){
                    dVal = "0";
                }
                
                dictOfStates[st] = dVal .toFixed(2);
            });
        });
        
        xval = [];
        yval = []
        for (const [key, value] of Object.entries(dictOfStates)) {
            // console.log(`${key}: ${value}`);
            if (isNaN(value)){
                continue;
            }
            console.log(value); 
            xval.push(value);
            yval.push(key);
        };

        let trace = {
            x: xval,
            y: yval,
            lable: yearSelected,
            
            type: 'bar',
            orientation:"h",
            mode: 'lines+markers',
            marker: { color: "cyan-blue" },
        };

        let layout = {
            margin: { t: 30, l: 150 },
            width: 1200,
            height: 500,
            title: "STATE - PERCENTAGE YEAR " + yearSelected
        };

        Plotly.newPlot("plot", [ trace ], layout);
        };

    eel.expose(updateMessage);
    function updateMessage(message) {
        document.getElementById("onPageMessage").innerHTML = message;
    };

</script>
